var MediaPlayer=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=23)}([function(e,t){var i={CLEAR_KEY:{title:"ClearKey",keySystem:"org.w3.clearkey",uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b"},FAIRPLAY:{title:"Fairplay",keySystem:"com.apple.fps.1_0",uuid:null},PLAYREADY:{title:"PlayReady",keySystem:"com.microsoft.playready",licenseUrl:"https://pr-keyos.licensekeyserver.com/core/rightsmanager.asmx",uuid:"9a04f079-9840-4286-ab92-e65be0885f95"},WIDEVINE:{title:"Widevine",keySystem:"com.widevine.alpha",licenseUrl:"https://wv-keyos.licensekeyserver.com",uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}},n=[i.WIDEVINE,i.PLAYREADY,i.FAIRPLAY,i.CLEAR_KEY],r={"com.widevine.alpha":i.WIDEVINE,"com.microsoft.playready":i.PLAYREADY,"com.apple.fps.1_0":i.FAIRPLAY,"org.w3.clearkey":i.CLEAR_KEY},o={CENC:"cenc",CBCS:"cbcs"},s={ClearKey_CENC:{cdm:i.CLEAR_KEY,type:o.CENC,value:1},ClearKey_CBCS:{cdm:i.CLEAR_KEY,type:o.CBCS,value:2},Widevine_CENC:{cdm:i.WIDEVINE,type:o.CENC,value:4},Widevine_CBCS:{cdm:i.WIDEVINE,type:o.CBCS,value:8},PlayReady_CENC:{cdm:i.PLAYREADY,type:o.CENC,value:16},PlayReady_CBCS:{cdm:i.PLAYREADY,type:o.CBCS,value:32},FairPlay_CENC:{cdm:i.FAIRPLAY,type:o.CENC,value:64},FairPlay_CBCS:{cdm:i.FAIRPLAY,type:o.CBCS,value:128}},a={chrome:[s.ClearKey_CENC,s.Widevine_CENC],firefox:[s.ClearKey_CENC,s.Widevine_CENC],edge:[s.PlayReady_CENC],safari:[s.FairPlay_CBCS]},u=[s.ClearKey_CENC,s.ClearKey_CBCS,s.Widevine_CENC,s.Widevine_CBCS,s.PlayReady_CENC,s.PlayReady_CBCS,s.FairPlay_CENC,s.FairPlay_CBCS],c={NO_CDM_SUPPORT:{code:4,message:"Your browser does not support any DRM Content Decryption Modules"},SESSION_UPDATE:{code:4,message:"There was an issue while updating DRM License"},LICENSE_REQUEST:{code:4,message:"Error while requesting DRM license"},KEY_SESSION_CREATION:{code:4,message:"Error while requesting DRM license"},NO_PSSH_FOUND:{code:4,message:"Unable to find valid CDM support on media"},UNCAUGHT_ERROR:{code:4,message:"An uncaught error occurred"}};e.exports={MODES:{DEVELOPMENT:"DEVELOPMENT",PRODUCTION:"PRODUCTION"},KEY_SYSTEMS:i,KEY_SYSTEMS_BY_STRING:r,TEST_AUTH_XML:"PEtleU9TQXV0aGVudGljYXRpb25YTUw+PERhdGE+PEdlbmVyYXRpb25UaW1lPjIwMTgtMDMtMDEgMTk6MjE6NTQuMTEzPC9HZW5lcmF0aW9uVGltZT48RXhwaXJhdGlvblRpbWU+MjAxOC0wNS0wMSAxOToyMTo1NC4xMTQ8L0V4cGlyYXRpb25UaW1lPjxVbmlxdWVJZD5iZDc4OTk2YzU5NTg0OTNmYmQ2YTcwMzI3YzVlNWI1NzwvVW5pcXVlSWQ+PFJTQVB1YktleUlkPmExN2ZkMzNkMzg0M2RmOWIxNzY3OWNjZjUwYTQxOWIyPC9SU0FQdWJLZXlJZD48V2lkZXZpbmVQb2xpY3kgZmxfQ2FuUGxheT0idHJ1ZSIgZmxfQ2FuUGVyc2lzdD0iZmFsc2UiIC8+PFdpZGV2aW5lQ29udGVudEtleVNwZWMgVHJhY2tUeXBlPSJIRCI+PFNlY3VyaXR5TGV2ZWw+MTwvU2VjdXJpdHlMZXZlbD48L1dpZGV2aW5lQ29udGVudEtleVNwZWM+PEZhaXJQbGF5UG9saWN5IC8+PExpY2Vuc2UgdHlwZT0ic2ltcGxlIj48UGxheT48SWQ+YTU0NWRiNTUtNDQ3Ny00ODhhLTlhNzEtMWNkZGUyMzNkZGUxPC9JZD48L1BsYXk+PC9MaWNlbnNlPjxQbGF5IGlkPSJhNTQ1ZGI1NS00NDc3LTQ4OGEtOWE3MS0xY2RkZTIzM2RkZTEiPjxFbmFibGVycz48SWQ+Nzg2NjI3ZDgtYzJhNi00NGJlLThmODgtMDhhZTI1NWIwMWE3PC9JZD48L0VuYWJsZXJzPjwvUGxheT48L0RhdGE+PFNpZ25hdHVyZT5HTVEzbFF2Q0I3SVo5ekY3b3U4eVJmMHdYTmttZXV0NitEdXVBY0pwMnJ3L3ZaTSt6ZllnOU1GbkpJa0N6cTdWb1p3a3hTdUQ1K0FSV2lvMm9wMTVRVHBlVHVubHZ2MktJYTRHM3p5Ukc5MmkzZk5qbmlFSTVROFVJeXcwMmxIVjEyZkU1eFdSTlJhc255azlISlFHSUlqWkIxazFad2RUMmpNVTNoK1JSNjFXdUpRcjlHVzgxSXdHYld3dGtlOSs3aXRxZ2Qxa2JmbGR4aHRnK2RnQW5YM3pnVzlDOFRoNm8vdnVBVUI3dVdBSFlGVWc2WEQrYTBteHpPQ29DZnh2aFg3VlQ3YzhWa1RKQzE1dCtTUmgyTUlpUUdidzNtRlNZWHpvaUljc2tFbnBtakVmWFJnazZxMFQxR1VJQTN4MXM4US8rS2RsMXg2WWpmV2UvOUltM3c9PTwvU2lnbmF0dXJlPjwvS2V5T1NBdXRoZW50aWNhdGlvblhNTD4=",ENCRYPTION_TYPES:o,SUPPORTED_DRM_MAP:s,DRM_SUPPORT_BY_BROWSER:a,DRM_SUPPORT_VALUES:u,ALL_KEY_SYSTEMS:n,SUPPORTED_BROWSERS:["chrome","firefox","edge","safari"],DEFAULT_VIDEO_CAPABILITIES:[{contentType:'video/mp4;codecs="avc1.42E01E"'}],DEFAULT_AUDIO_CAPABILITIES:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],ERRORS:c}},function(e){e.exports={buffercontrol:{rebufferPenalty:1}}},function(e){e.exports={buffercontrol:{liveSpeedUpRate:1}}},function(e,t,i){var n={"./nospd.json":2,"./rebuf1.json":1};function r(e){var t=o(e);return i(t)}function o(e){var t=n[e];if(!(t+1)){var i=new Error('Cannot find module "'+e+'".');throw i.code="MODULE_NOT_FOUND",i}return t}r.keys=function(){return Object.keys(n)},r.resolve=o,e.exports=r,r.id=3},function(e,t){e.exports={PLAYER_LOADED_IN_WORKER:"player_loaded_in_worker",HLS_MASTER_PLAYLIST_REQUEST:"master_manifest_request",HLS_MASTER_PLAYLIST_READY:"master_manifest_ready",HLS_MEDIA_PLAYLIST_REQUEST:"variant_request",HLS_MEDIA_PLAYLIST_READY:"variant_ready"}},function(e,t){e.exports={UNKNOWN:"Unspecified",FILE:"File",PLAYLIST:"Playlist",SEGMENT:"Segment",SOURCE:"Source",DECODER:"Decode",RENDERER:"Render"}},function(e,t){e.exports={GENERIC:"Error",NOT_SUPPORTED:"ErrorNotSupported",NO_SOURCE:"ErrorNoSource",INVALID_DATA:"ErrorInvalidData",INVALID_STATE:"ErrorInvalidState",INVALID_PARAMETER:"ErrorInvalidParameter",TIMEOUT:"ErrorTimeout",INVALID_OUTPUT:"ErrorInvalidOutput",INTERNAL:"ErrorInternal",NETWORK:"ErrorNetwork",NETWORK_IO:"ErrorNetworkIO",AUTHORIZATION:"ErrorAuthorization",NOT_AVAILABLE:"ErrorNotAvailable",EXCEPTION:"ErrorException"}},function(e,t){e.exports={ID3:"MetaID3",CAPTION:"MetaCaption",SPLICE_OUT:"MetaSpliceOut",SPLICE_IN:"MetaSpliceIn"}},function(e,t){e.exports={IDLE:"Idle",READY:"Ready",BUFFERING:"Buffering",PLAYING:"Playing",ENDED:"Ended"}},function(e,t){e.exports={INITIALIZED:"PlayerInitialized",QUALITY_CHANGED:"PlayerQualityChanged",AUTO_SWITCH_QUALITY_CHANGED:"PlayerAutoSwitchQualityChanged",DURATION_CHANGED:"PlayerDurationChanged",VOLUME_CHANGED:"PlayerVolumeChanged",MUTED_CHANGED:"PlayerMutedChanged",PLAYBACK_RATE_CHANGED:"PlayerPlaybackRateChanged",REBUFFERING:"PlayerRebuffering",AUDIO_BLOCKED:"PlayerAudioBlocked",PLAYBACK_BLOCKED:"PlayerPlaybackBlocked",ERROR:"PlayerError",TRACKING:"PlayerTracking",TIME_UPDATE:"PlayerTimeUpdate",BUFFER_UPDATE:"PlayerBufferUpdate",SEEK_COMPLETED:"PlayerSeekCompleted",PROFILE:"PlayerProfile",TWITCH_INFO:"PlayerTwitchInfo",WORKER_ERROR:"PlayerWorkerError"}},function(e,t){e.exports={STATE_CHANGED:"ClientStateChanged",STATS:"ClientStats",SAVE_ITEM:"ClientSaveItem",CONFIGURE:"ClientConfigure",ENQUEUE:"ClientEnqueue",SET_TIMESTAMP_OFFSET:"ClientSetTimestampOffset",PLAY:"ClientPlay",PAUSE:"ClientPause",REMOVE:"ClientRemove",RESET:"ClientReset",SEEK_TO:"ClientSeekTo",SET_PLAYBACK_RATE:"ClientSetPlaybackRate",ADD_CUE:"ClientAddCue"}},function(e,t){e.exports={CREATE:"WorkerCreate",DELETE:"WorkerDelete",SINK_UPDATE:"WorkerSinkUpdate",SINK_IDLE:"WorkerSinkIdle",SINK_ERROR:"WorkerSinkError",SINK_CUE:"WorkerSinkCue",LOAD:"WorkerLoad",PLAY:"WorkerPlay",PAUSE:"WorkerPause",SEEK_TO:"WorkerSeekTo",SET_LOOPING:"WorkerSetLooping",SET_QUALITY:"WorkerSetQuality",REMOVE_QUALITIES:"WorkerRemoveQualities",SET_AUTO_SWITCH_QUALITY:"WorkerSetAutoSwitchQuality",SET_AUTO_MAX_VIDEO_SIZE:"WorkerSetAutoMaxVideoSize",SET_VOLUME:"WorkerSetVolume",SET_MUTED:"WorkerSetMuted",SET_PLAYBACK_RATE:"WorkerSetPlaybackRate",SET_AD_INSERTION_ENABLED:"WorkerSetAdInsertionEnabled",SET_LIVE_MAX_LATENCY:"WorkerSetLiveMaxLatency",SET_ANALYTICS_SEND_EVENTS:"WorkerSetAnalyticsSendEvents"}},function(e,t){},function(e,t,i){function n(e){var t=s([["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]]).filter(function(t){return t.rule&&t.rule.test(e)})[0];return t?t.name:null}function r(){return"undefined"==typeof navigator&&"undefined"!=typeof process?{name:"node",version:process.version.slice(1),os:i(12).type().toLowerCase()}:null}function o(e){var t=s([["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/]]);if(!e)return null;var i=t.map(function(t){var i=t.rule.exec(e),n=i&&i[1].split(/[._]/).slice(0,3);return n&&n.length<3&&(n=n.concat(1==n.length?[0,0]:[0])),i&&{name:t.name,version:n.join(".")}}).filter(Boolean)[0]||null;return i&&(i.os=n(e)),i}function s(e){return e.map(function(e){return{name:e[0],rule:e[1]}})}e.exports={detect:function(){var e=r();return e||("undefined"!=typeof navigator?o(navigator.userAgent):null)},detectOS:n,getNodeVersion:r,parseUserAgent:o}},function(e,t,i){var n,r,o=i(13).detect,s=(n=o()||{name:"",version:"",os:""},r=n.version.split("."),n.major=parseInt(r[0],10),n.minor=parseInt(r[1],10),n.patch=parseInt(r[2],10),n);e.exports={browser:s,supportsSingleFrameFragments:function(e){if(navigator.userAgent.toLowerCase().indexOf("crkey")>-1)return!1;var t=e.name,i=e.major;return"chrome"==t&&i>=50||"firefox"==t&&i>=45||"safari"==t&&i>=11}(s),supportedCDMs:function(e){var t={chrome:5,firefox:5,edge:16,safari:128};return t[e.name]?t[e.name]:0}(s),supportsLowLatencyABR:function(e){return"chrome"===e.name}(s)}},function(e,t){!function(t){var i=setTimeout;function n(){}function r(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function o(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,r._immediateFn(function(){var i=1===e._state?t.onFulfilled:t.onRejected;if(null!==i){var n;try{n=i(e._value)}catch(e){return void a(t.promise,e)}s(t.promise,n)}else(1===e._state?s:a)(t.promise,e._value)})):e._deferreds.push(t)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof r)return e._state=3,e._value=t,void u(e);if("function"==typeof i)return void c((n=i,o=t,function(){n.apply(o,arguments)}),e)}e._state=1,e._value=t,u(e)}catch(t){a(e,t)}var n,o}function a(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&r._immediateFn(function(){e._handled||r._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;t<i;t++)o(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var i=!1;try{e(function(e){i||(i=!0,s(t,e))},function(e){i||(i=!0,a(t,e))})}catch(e){if(i)return;i=!0,a(t,e)}}r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var i=new this.constructor(n);return o(this,new function(e,t,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=i}(e,t,i)),i},r.all=function(e){var t=Array.prototype.slice.call(e);return new r(function(e,i){if(0===t.length)return e([]);var n=t.length;function r(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){r(o,e)},i)}t[o]=s,0==--n&&e(t)}catch(e){i(e)}}for(var o=0;o<t.length;o++)r(o,t[o])})},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,i){i(e)})},r.race=function(e){return new r(function(t,i){for(var n=0,r=e.length;n<r;n++)e[n].then(t,i)})},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){i(e,0)},r._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},r._setImmediateFn=function(e){r._immediateFn=e},r._setUnhandledRejectionFn=function(e){r._unhandledRejectionFn=e},void 0!==e&&e.exports?e.exports=r:t.Promise||(t.Promise=r)}(this)},function(e,t){var i=e.exports=function(){this._buffer=[],this._head=0,this._tail=0};i.prototype.push=function(e){this._tail===this._buffer.length?this._buffer.push(e):this._buffer[this._tail]=e,this._tail++},i.prototype.pop=function(){var e=this._buffer[this._head];return this._buffer[this._head]=null,this._head++,this.empty()&&(this._head=0,this._tail=0),e},i.prototype.size=function(){return this._tail-this._head},i.prototype.empty=function(){return this._head>=this._tail}},function(e,t){e.exports={licenseRequestData:function(e){var t,i,n=new DOMParser,r=new Uint16Array(e);return t=String.fromCharCode.apply(null,r),{headers:function(e){for(var t={},i=e.getElementsByTagName("name"),n=e.getElementsByTagName("value"),r=0;r<i.length;r++)t[i[r].childNodes[0].nodeValue]=n[r].childNodes[0].nodeValue;return t}(i=n.parseFromString(t,"application/xml")),body:function(e){var t=null;if(e.getElementsByTagName("Challenge").length>0&&e.getElementsByTagName("Challenge")[0]){var i=e.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;i&&(t=atob(i))}return t}(i)}}}},function(e,t,i){var n=i(0),r=n.ALL_KEY_SYSTEMS,o=function(e){var t=[];return e.forEach(function(e){r.forEach(function(i){i.uuid===e&&t.push(i)})}),t},s=function(e){var t,i,n=new Uint8Array(e),r=new DataView(n.buffer),o=4;if(1886614376!==r.getUint32(o))return o=nextBox,console.warn("pssh was not verified"),null;if(o+=4,version=r.getUint8(o),0!==version&&1!==version)return o=nextBox,console.warn("pssh version must be 0 or 1"),null;for(o++,o+=3,systemID="",t=0;t<4;t++)i=r.getUint8(o+t).toString(16),systemID+=1===i.length?"0"+i:i;for(o+=4,systemID+="-",t=0;t<2;t++)i=r.getUint8(o+t).toString(16),systemID+=1===i.length?"0"+i:i;for(o+=2,systemID+="-",t=0;t<2;t++)i=r.getUint8(o+t).toString(16),systemID+=1===i.length?"0"+i:i;for(o+=2,systemID+="-",t=0;t<2;t++)i=r.getUint8(o+t).toString(16),systemID+=1===i.length?"0"+i:i;for(o+=2,systemID+="-",t=0;t<6;t++)i=r.getUint8(o+t).toString(16),systemID+=1===i.length?"0"+i:i;return o+=6,systemID.toLowerCase()},a=function(e){if(null===e)return[];for(var t=new DataView(e.buffer||e),i=[],n=0;;){var r,o,s;if(n>=t.buffer.byteLength)break;if(r=n+t.getUint32(n),n+=4,1886614376===t.getUint32(n))if(n+=4,0===(o=t.getUint8(n))||1===o){var a,u;for(n++,n+=3,s="",a=0;a<4;a++)s+=1===(u=t.getUint8(n+a).toString(16)).length?"0"+u:u;for(n+=4,s+="-",a=0;a<2;a++)s+=1===(u=t.getUint8(n+a).toString(16)).length?"0"+u:u;for(n+=2,s+="-",a=0;a<2;a++)s+=1===(u=t.getUint8(n+a).toString(16)).length?"0"+u:u;for(n+=2,s+="-",a=0;a<2;a++)s+=1===(u=t.getUint8(n+a).toString(16)).length?"0"+u:u;for(n+=2,s+="-",a=0;a<6;a++)s+=1===(u=t.getUint8(n+a).toString(16)).length?"0"+u:u;n+=6,s=s.toLowerCase(),t.getUint32(n),n+=4,i.push(s),n=r}else n=r;else n=r}return i};e.exports={arrayBuffersEqual:function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(var i=new DataView(e),n=new DataView(t),r=0;r<i.byteLength;r++)if(i.getUint8(r)!==n.getUint8(r))return!1;return!0},arrayBufferFrom:function(e){return e instanceof Uint8Array||e instanceof Uint16Array?e.buffer:e},uintArrayToString:function(e){return e instanceof Uint8Array?String.fromCharCode.apply(null,new Uint8Array(e)):String.fromCharCode.apply(null,new Uint16Array(e))},getHostnameFromUri:function(e){var t=document.createElement("a");return t.href=e,t.hostname},fetchArrayBuffer:function(e,t){return new Promise(function(i,n){var r=new XMLHttpRequest;for(var o in r.open(t.method,e,!0),t.headers)t.headers.hasOwnProperty(o)&&r.setRequestHeader(o,t.headers[o]);r.responseType="arraybuffer",r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)i(r.response);else{var e="Request Error: Status "+r.status;console.warn(e),n(e)}},r.send(t.body)})},parsePSSHSupport:function(e){var t=e.map(s);return o(t)},parsePSSHSupportFromInitData:function(e){var t=a(e);return o(t)},checkErrorFormat:function(e){return e.code&&e.message?e:n.ERRORS.UNCAUGHT_ERROR}}},function(e,t,i){var n=i(0),r=i(18),o=i(17),s=(n.MODES,n.KEY_SYSTEMS),a=n.KEY_SYSTEMS_BY_STRING,u=n.TEST_AUTH_XML,c=n.ENCRYPTION_TYPES,d=(n.SUPPORTED_DRM_MAP,n.DRM_SUPPORT_BY_BROWSER),h=n.DRM_SUPPORT_VALUES,p=n.SUPPORTED_BROWSERS,l=n.DEFAULT_AUDIO_CAPABILITIES,_=n.DEFAULT_VIDEO_CAPABILITIES,f=r.arrayBuffersEqual,m=r.getHostnameFromUri,y=r.arrayBufferFrom,E=r.uintArrayToString,S=r.fetchArrayBuffer,v=(r.parsePSSHSupport,r.parsePSSHSupportFromInitData),g=r.checkErrorFormat,T=n.ERRORS,C=[{initDataTypes:[c.CENC],audioCapabilities:l,videoCapabilities:_}],A=function(e){this.video=e.video,this.cdmSupport=null,this.selectedCDM=null,this.mediaKeys=void 0,this.initialized=!1,this._handleError=e.onerror,this._certificate=null,this._currentSrc=null,this._pendingSessions=[],this._sessions=[],this._init()};A.CDMCapabilitiesByBrowser=function(e){return d[e]?d[e].reduce(function(e,t){return e+(t?t.value:0)},0):0},A.DRMBrowserSupportMapping=function(e){var t={};return p.forEach(function(e){t[e]=A.CDMCapabilitiesByBrowser(e)}),t},A.CDMCapabilitiesFeatureCheck=function(){var e;if(navigator.requestMediaKeySystemAccess)e=h.map(function(e){return function(e){var t=[{initDataTypes:[e.type],audioCapabilities:l,videoCapabilities:_}];return navigator.requestMediaKeySystemAccess(e.cdm.keySystem,t).then(function(){return e}).catch(function(){})}(e)});else{if(!window.WebKitMediaKeys)return Promise.resolve(0);e=h.map(function(e){return function(e){if(e.type!==c.CBCS)return Promise.resolve(void 0);try{return WebKitMediaKeys.isTypeSupported(e.cdm.keySystem)?Promise.resolve(e):Promise.resolve(void 0)}catch(e){return Promise.resolve(void 0)}}(e)})}return Promise.all(e).then(function(e){return e.reduce(function(e,t){return e+(t?t.value:0)},0)})},A.prototype._init=function(){this._checkSrcSessions(),this.video.addEventListener("encrypted",this._handleEncrypted.bind(this),!1),this.video.addEventListener("webkitneedkey",this._handleSafariEncrypted.bind(this),!1)},A.prototype.configureCDMSupport=function(e){},A.prototype._hasSession=function(e){for(var t=0;t<this._sessions.length;t++){var i=this._sessions[t];if(i.initData&&f(y(i.initData),y(e)))return!0}return!1},A.prototype._checkSrcSessions=function(){var e=this.video.src;e!==this._currentSrc&&(this._currentSrc=e,this._sessions=[])},A.prototype._createKeySystemSupportChain=function(){return null===this.cdmSupport||0===this.cdmSupport.length?Promise.reject(T.NO_PSSH_FOUND):(this.cdmSupport.forEach(function(t){e=e?e.catch(function(e){return navigator.requestMediaKeySystemAccess(t.keySystem,C)}):navigator.requestMediaKeySystemAccess(t.keySystem,C)}),e=e.catch(function(){return Promise.reject(T.NO_CDM_SUPPORT)}));var e},A.prototype._handleEncrypted=function(e){var t;if(this._checkSrcSessions(),!this._hasSession(e.initData))return this._sessions.push({initData:e.initData}),null===this.cdmSupport&&(this.cdmSupport=v(e.initData)),void 0===this.mediaKeys&&(this.mediaKeys=null,this._pendingSessions=[],t=this._createKeySystemSupportChain().then(this._getCertificate.bind(this)).then(function(e){return e.createMediaKeys()}).then(this._setMediaKeys.bind(this)).catch(function(e){this._handleError(g(e))}.bind(this))),this._addSession(e.initDataType,e.initData),t},A.prototype._setMediaKeys=function(e){return this.mediaKeys=e,this._certificate&&this.setServerCertificate(certificate),this._pendingSessions.forEach(function(e){this._createSessionRequest(e.initDataType,e.initData)}.bind(this)),this._pendingSessions=[],this.video.setMediaKeys(this.mediaKeys)},A.prototype._addSession=function(e,t){this.mediaKeys?this._createSessionRequest(e,t).catch(function(e){this._handleError(T.KEY_SESSION_CREATION)}.bind(this)):this._pendingSessions.push({initDataType:e,initData:t})},A.prototype._createSessionRequest=function(e,t){var i=this.mediaKeys.createSession();return i.addEventListener("message",this._handleMessage.bind(this),!1),i.addEventListener("keystatuseschange",function(e){this._handleKeyStatusesChange(i,e,t)}.bind(this),!1),i.generateRequest(e,t)},A.prototype._handleKeyStatusesChange=function(e,t,i){var n=!1;e.keyStatuses.forEach(function(e,i){switch(e){case"expired":n=!0;break;case"internal-error":console.warn("Key status reported 'internal-error'. Leaving it open since we aren't sure it is fatal",t)}}),n&&e.close().then(function(){this._removeSession(i)}.bind(this))},A.prototype._removeSession=function(e){for(var t=0;t<this._sessions.length;t++){if(this._sessions[t].initData===e)return void this._sessions.splice(t,1)}},A.prototype._getCertificate=function(e){return this.selectedCDM=a[e.keySystem],Promise.resolve(e)},A.prototype._handleMessage=function(e){var t=e.target;this._generateLicense(e.message).then(function(e){return t.update(e).catch(function(e){return Promise.reject(T.SESSION_UPDATE)})}).catch(function(e){this._handleError(g(e))}.bind(this))},A.prototype._generateLicense=function(e){if(this.selectedCDM===s.CLEAR_KEY){var t=JSON.parse((new TextDecoder).decode(e)).kids.map(function(e){return{kty:"oct",alg:"A128KW",kid:e,k:e}}),i=(new TextEncoder).encode(JSON.stringify({keys:t}));return Promise.resolve(i)}var n=this._prepareLicenseRequest(e);return S(n.url,n.options).catch(function(e){return Promise.reject(T.LICENSE_REQUEST)})},A.prototype._prepareLicenseRequest=function(e){var t=e,i={customdata:u},n={};return this.selectedCDM===s.PLAYREADY&&(n=o.licenseRequestData(e)),n.body&&(t=n.body),n.headers&&(i=Object.assign(i,n.headers)),{url:this.selectedCDM.licenseUrl,options:{method:"POST",body:t,headers:i}}},A.prototype._handleSafariEncrypted=function(e){this._getSafariCertificate().then(this._setupSafariMediaKeys.bind(this,e)).catch(function(e){console.error("there was an error creating safari key",e)})},A.prototype._getSafariCertificate=function(){return Promise.resolve()},A.prototype._getSafariContentId=function(e){return m(E(e))},A.prototype._setupSafariMediaKeys=function(e){return new Promise(function(t,i){this.video.webkitKeys||this.video.webkitSetMediaKeys(new WebkitMediaKeys(s.CLEAR_KEY.keySystem)),this.video.webkitKeys||i("Issue setting fairplay media keys");var n=this.video.webkitKeys.createSession("video/mp4",e.initData);if(!n)return i("Could not create key session");n.contentId=contentId,n.addEventListener("webkitkeymessage",function(e){this._getWebkitLicense(e).then(function(e){n.update(new Uint8Array(e))}).catch(function(e){i(e)})}),n.addEventListener("webkitkeyadded",function(e){t(e)}),n.addEventListener("webkitkeyerror",function(e){i(e)})}.bind(this))},A.prototype._getWebkitLicense=function(e){return Promise.reject("Non-development License is not implemented")},e.exports=A},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){(function(e){var n=i(19),r=i(16),o=e.Promise?e.Promise:i(15),s=e.VTTCue?e.VTTCue:e.TextTrackCue,a=t.MediaSink=function(e){this._video=document.createElement("video"),this._metadataTrack=this._video.addTextTrack("metadata"),this._codecs=Object.create(null),this._atExit=[],this._ontimeupdate=e.ontimeupdate||u,this._onbufferupdate=e.onbufferupdate||u,this._onidle=e.onidle||u,this._onstop=e.onstop||u,this._onerror=e.onerror||u,this._drmManager=new n({video:this._video,onerror:this._onerror}),this._attachHandlers(),this.reset()};function u(){}function c(e,t,i){for(var n=e.cues,r=n.length-1;r>=0;r--){var o=n[r],s=o.startTime;if(s<t)break;s<i&&e.removeCue(o)}}function d(e,t){this._video=e,this._srcBuf=t,this._pending=new r,this._srcBuf.addEventListener("updateend",this._process.bind(this))}a.prototype.configure=function(e){if(this._drmManager.configureCDMSupport(e.protectionData),e.src)this._video.src=e.src;else{var t=this._video,i=e.trackID,n=e.codec;if(n?this._codecs[i]=n:n=this._codecs[i],this._mediaSource||(this._mediaSource=new o(function(e,i){var n=new MediaSource;n.addEventListener("sourceopen",function t(){n.removeEventListener("sourceopen",t),"open"===n.readyState?(n.duration=1<<30,e(n)):i(new Error("MediaSource not opened"))}),t.src=URL.createObjectURL(n)})),!(i in this._tracks))(e=this._mediaSource.then(function(e){var i=e.addSourceBuffer("video/mp4;"+n);return new d(t,i)})).catch(function(e){this._onerror({code:4,message:e.toString()})}.bind(this)),this._tracks[i]=e}},a.prototype.enqueue=function(e){var t=this._tracks[e.trackID];t&&t.then(function(t){t.appendBuffer(e.buffer)},u)},a.prototype.setTimestampOffset=function(e){var t=this._tracks[e.trackID];t&&t.then(function(t){t.setTimestampOffset(e.offset)},u)},a.prototype.play=function(){this._paused=!1;var e=o.resolve(this._video.play());return e.catch(this._checkStopped.bind(this)),e},a.prototype.pause=function(){this._idle=!0,this._paused=!0,this._video.pause()},a.prototype.reset=function(){if(this._mediaSource=null,this._tracks=Object.create(null),this._idle=!0,this._paused=!0,this._iosFullScreen=!1,c(this._metadataTrack,0,1/0),this._video.src){var e=this._video.src;this._video.removeAttribute("src"),this._video.load(),URL.revokeObjectURL(e)}},a.prototype.remove=function(e){var t=e.start,i=e.end;function n(e){e.remove(t,i)}for(var r in this._tracks)this._tracks[r].then(n);c(this._metadataTrack,t,i)},a.prototype.seekTo=function(e){var t=this.buffered();if(e>=t.start&&e<t.end){function i(e){return new o(function(t){e.schedule(t)})}var n=[];for(var r in this._tracks)n.push(this._tracks[r].then(i));o.all(n).then(function(){this._video.currentTime=e}.bind(this))}else this._video.currentTime=e},a.prototype.setPlaybackRate=function(e){this._video.playbackRate=e},a.prototype.addCue=function(e,t){var i=new s(e,e+1,"");i.onenter=t,this._metadataTrack.addCue(i)},a.prototype.currentTime=function(){return this._video.currentTime},a.prototype.buffered=function(){for(var e=this._video.buffered,t=this._video.currentTime,i=0;i<e.length;i++){var n=e.start(i);if(t>=n){var r=e.end(i);for(i++;i<e.length&&!(e.start(i)-r>.1);i++)r=e.end(i);if(t<r)return{start:n,end:r};break}}return{start:t,end:t}},a.prototype.bufferDuration=function(){return this.buffered().end-this._video.currentTime},a.prototype.decodedFrames=function(){return"number"==typeof this._video.webkitDecodedFrameCount?this._video.webkitDecodedFrameCount:"number"==typeof this._video.mozDecodedFrames?this._video.mozDecodedFrames:-1},a.prototype.droppedFrames=function(){if("number"==typeof this._video.webkitDroppedFrameCount)return this._video.webkitDroppedFrameCount;if("function"==typeof this._video.getVideoPlaybackQuality){var e=this._video.getVideoPlaybackQuality();return e?e.droppedVideoFrames:-1}return-1},a.prototype.videoElement=function(){return this._video},a.prototype.delete=function(){this.reset(),this._atExit.forEach(function(e){e()}),this._audioSource=null,this._videoSource=null,this._video=null,this._metadataTrack=null},a.prototype._attachHandlers=function(){var e=function(e,t,i){e.addEventListener(t,i),this._atExit.push(function(){e.removeEventListener(t,i)})}.bind(this);e(this._video,"timeupdate",this._createOnVideoTimeUpdate()),e(this._video,"pause",this._onVideoPause.bind(this)),e(this._video,"error",this._onVideoError.bind(this)),e(this._video,"webkitbeginfullscreen",this._onWebkitBeginFullscreen.bind(this)),e(this._video,"webkitendfullscreen",this._onWebkitEndFullscreen.bind(this))},a.prototype._updateIdle=function(e){if(!this._video.paused){var t=e<.1;t&&!this._idle&&this._onidle(),this._idle=t}},a.prototype._fixStall=function(e){if(!this._video.paused){var t=this._video.buffered,i=e>.1;if(t.length>1||!i)for(var n=this._video.currentTime,r=0;r<t.length;r++){var o=t.start(r),s=t.end(r);if(n<o&&s-o>.1)return console.warn("jumping "+(o-n)+"s gap"),void(this._video.currentTime=o+.1)}i&&(console.warn("stalled within buffer"),this._video.currentTime+=.1)}},a.prototype._checkStopped=function(){!this._video.paused||this._video.error||this._paused||this._iosFullScreen||this._onstop()},a.prototype._createOnVideoTimeUpdate=function(){var t,i=e.performance.now(),n=0,r=function(e){e!==n&&(n=e,this._onbufferupdate())}.bind(this),o=function(){i=e.performance.now();var t=this.buffered().end;this._updateIdle(t-this._video.currentTime),r(t),this._ontimeupdate()}.bind(this),s=function(){var n=e.performance.now()-i;if(n<1500)t=setTimeout(s,1500-n);else{var o=this.buffered().end;this._fixStall(o-this._video.currentTime),r(o),t=setTimeout(s,1500)}}.bind(this);return t=setTimeout(s,1500),this._atExit.push(function(){clearInterval(t)}),o},a.prototype._onWebkitBeginFullscreen=function(){this._iosFullScreen=!0},a.prototype._onWebkitEndFullscreen=function(){this._iosFullScreen=!1},a.prototype._onVideoPause=function(){this._checkStopped()},a.prototype._onVideoError=function(){var e=this._video.error;this._onerror({code:e.code,message:e.message||""})},d.prototype.appendBuffer=function(e){this.schedule(function(t){t.appendBuffer(e)})},d.prototype.setTimestampOffset=function(e){this.schedule(function(t){t.timestampOffset=e})},d.prototype.remove=function(e,t){this.schedule(function(i){i.remove(e,t)})},d.prototype.schedule=function(e){this._pending.empty()&&!this._updating()?e(this._srcBuf):this._pending.push(e)},d.prototype._process=function(){for(;!this._pending.empty()&&!this._updating();)this._pending.pop()(this._srcBuf)},d.prototype._updating=function(){return!this._srcBuf||this._srcBuf.updating||null!==this._video.error}}).call(this,i(20))},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,s,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(o(i=this._events[e]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(r(i))for(a=Array.prototype.slice.call(arguments,1),s=(c=i.slice()).length,u=0;u<s;u++)c[u].apply(this,a);return!0},i.prototype.addListener=function(e,t){var s;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var i,o,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(i=this._events[e]).length,o=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(i)){for(a=s;a-- >0;)if(i[a]===t||i[a].listener&&i[a].listener===t){o=a;break}if(o<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){var n=i(22),r=i(21).MediaSink,o=i(14).browser,s=i(11),a=i(10),u=t.PlayerEvent=i(9),c=t.PlayerState=i(8),d=t.MetadataEvent=i(7),h=(t.ErrorType=i(6),t.ErrorSource=i(5),t.Profile=t.ProfileEvent=i(4),"chrome"===o.name&&63===o.major||"opera"===o.name||"safari"===o.name),p=t.MediaPlayer=function(e,t){this._worker=t,this._id=f(),this._emitter=new n,this._seekTime=null,this._isPaused=!0,this._isLoaded=!1,this._isQualitySupported=e.isQualitySupported||E,this._onvisibilitychange=this._onVisibilityChange.bind(this),this._onmessage=this._onWorkerMessage.bind(this),this._mediaSink=new r({ontimeupdate:this._onSinkTimeUpdate.bind(this),onbufferupdate:this._onSinkBufferUpdate.bind(this),onidle:this._onSinkIdle.bind(this),onstop:this._onSinkStop.bind(this),onerror:this._onSinkError.bind(this)}),this._state={looping:!1,autoSwitchQuality:!0},this._stats={},this._resetState(),this._attachHandlers(),this._postMessage(s.CREATE,{settings:function(e){try{return i(3)("./"+e+".json")}catch(e){return{}}}(e.settings||e.latencyValue),logLevel:String(e.logLevel),localStorage:function(e){var t=Object.create(null);try{for(var i=0;i<localStorage.length;i++){var n=localStorage.key(i);n.substr(0,e.length)===e&&(t[n.substr(e.length)]=localStorage.getItem(n))}}catch(e){console.warn("localStorage not available:",e)}return t}("cvp."),clientTrackingInfo:function(){var e,t;try{var i=document.createElement("canvas"),n=i.getContext("experimental-webgl"),r=n.getExtension("WEBGL_debug_renderer_info");e=n.getParameter(r.UNMASKED_RENDERER_WEBGL),t=n.getParameter(r.UNMASKED_VENDOR_WEBGL)}catch(e){console.error("webgl context not available",e)}return{gl_renderer:e||"",gl_vendor:t||""}}(),mseSupported:m()}),setTimeout(function(){this._emitter.emit(u.INITIALIZED)}.bind(this),0)};function l(){}p.createWorker=function(e,t,i){var n=`\n        var Module = {\n            WASM_BINARY_URL: '${t}',\n            WASM_CACHE_MODE: ${i}\n        }\n        importScripts('${e}');\n    `;return new Worker(URL.createObjectURL(new Blob([n])))},p.prototype.delete=function(){this._postMessage(s.DELETE),this._worker.removeEventListener("message",this._onmessage),document.removeEventListener("visibilitychange",this._onvisibilitychange),this._mediaSink.delete(),this._worker=null,this._mediaSink=null,this._emitter=null},p.prototype.getHTMLVideoElement=function(){return this._mediaSink.videoElement()},p.prototype.load=function(e){this._srcUrl=e,this._postMessage(s.LOAD,e),this._resetState()},p.prototype.play=function(){this._mediaSink.videoElement().paused&&(this._mediaSink.play(),this._mediaSink.pause()),this._isPaused=!1,this._attemptPlay()},p.prototype.pause=function(){this._isPaused=!0,this._postMessage(s.PAUSE)},p.prototype.isPaused=function(){return this._isPaused},p.prototype.seekTo=function(e){this.getDuration()>.5&&(e=Math.min(e,this.getDuration()-.5)),e=Math.max(0,e),this._seekTime=e,this._postMessage(s.SEEK_TO,e)},p.prototype.isSeeking=function(){return null!==this._seekTime},p.prototype.getVideoSrc=function(){return this._mediaSink.videoElement().src},p.prototype.getDuration=function(){return this._state.duration||this._mediaSink.videoElement().duration},p.prototype.getStartOffset=function(){return this._state.startOffset},p.prototype.getPosition=function(){return null===this._seekTime?this._mediaSink.currentTime():this._seekTime},p.prototype.getBuffered=function(){return this._mediaSink.buffered()},p.prototype.getBufferDuration=function(){return this._mediaSink.bufferDuration()},p.prototype.getPlayerState=function(){return this._state.playerState},p.prototype.getVideoWidth=function(){return this._mediaSink.videoElement().videoWidth},p.prototype.getVideoHeight=function(){return this._mediaSink.videoElement().videoHeight},p.prototype.getVideoFrameRate=function(){return this._stats.videoFrameRate},p.prototype.getVideoBitRate=function(){return this._stats.videoBitRate},p.prototype.getVersion=function(){return"2.5.16-32c910e0"},p.prototype.isLooping=function(){return this._state.looping},p.prototype.setLooping=function(e){this._postMessage(s.SET_LOOPING,e),this._state.looping=e},p.prototype.isMuted=function(){return this._mediaSink.videoElement().muted},p.prototype.setMuted=function(e){this._mediaSink.videoElement().muted=e,this._postMessage(s.SET_MUTED,e),this._emitter.emit(u.MUTED_CHANGED)},p.prototype.setVolume=function(e){this._mediaSink.videoElement().volume=e,this._postMessage(s.SET_VOLUME,e),this._emitter.emit(u.VOLUME_CHANGED)},p.prototype.getVolume=function(e){return this._mediaSink.videoElement().volume},p.prototype.getQuality=function(){return this._state.quality},p.prototype.setQuality=function(e){this._postMessage(s.SET_QUALITY,e)},p.prototype.getQualities=function(){return this._state.qualities},p.prototype.getAutoSwitchQuality=function(){return this._state.autoSwitchQuality},p.prototype.setAutoSwitchQuality=function(e){this._postMessage(s.SET_AUTO_SWITCH_QUALITY,e)},p.prototype.setAutoMaxVideoSize=function(e,t){this._postMessage(s.SET_AUTO_MAX_VIDEO_SIZE,{width:e,height:t})},p.prototype.getPlaybackRate=function(){return this._mediaSink.videoElement().playbackRate},p.prototype.setPlaybackRate=function(e){this._postMessage(s.SET_PLAYBACK_RATE,e)},p.prototype.setAdInsertionEnabled=function(e){this._postMessage(s.SET_AD_INSERTION_ENABLED,e)},p.prototype.setLiveMaxLatency=function(e){this._postMessage(s.SET_LIVE_MAX_LATENCY,e)},p.prototype.setAnalyticsSendEvents=function(e){this._postMessage(s.SET_ANALYTICS_SEND_EVENTS,e)},p.prototype.addEventListener=function(e,t){this._emitter.on(e,t)},p.prototype.removeEventListener=function(e,t){this._emitter.removeListener(e,t)},p.prototype.getDroppedFrames=function(){return this._mediaSink.droppedFrames()},p.prototype.getDecodedFrames=function(){return this._mediaSink.decodedFrames()},p.prototype.getDisplayWidth=function(){return this._mediaSink.videoElement().clientWidth},p.prototype.getDisplayHeight=function(){return this._mediaSink.videoElement().clientHeight},p.prototype.getManifestInfo=function(){return this._state.twitchInfo},p.prototype.getLiveLatency=function(){return this._stats.broadcasterLatency},p.prototype.getBroadcasterLatency=function(){return 1e3*this._stats.broadcasterLatency},p.prototype.getTranscoderLatency=function(){return 1e3*this._stats.transcoderLatency},p.prototype.getNetworkProfile=function(){return this._stats.networkProfile},p.prototype._attemptPlay=function(){!document.hidden&&this._isLoaded&&this._postMessage(s.PLAY)},p.prototype._postMessage=function(e,t){this._worker.postMessage({id:this._id,type:e,arg:t})},p.prototype._resetState=function(){y(this._state,{playerState:c.Idle,quality:{name:"",group:"",codecs:"",bitrate:0,width:0,height:0,framerate:0},qualities:[],duration:0,startOffset:0,twitchInfo:{}}),y(this._stats,{videoBitRate:0,videoFrameRate:0,broadcasterLatency:0,transcoderLatency:0,networkProfile:[]}),this._emitter.emit(u.DURATION_CHANGED,{duration:0}),this._seekTime=null,this._isLoaded=!1},p.prototype._attachHandlers=function(){this._worker.addEventListener("message",this._onmessage),document.addEventListener("visibilitychange",this._onvisibilitychange);var e=this._emitter,t=this._mediaSink,i=function(e){y(this._state,e)}.bind(this);e.on(u.QUALITY_CHANGED,i),e.on(u.AUTO_SWITCH_QUALITY_CHANGED,i),e.on(u.DURATION_CHANGED,i),e.on(u.VOLUME_CHANGED,this._onVolumeChanged.bind(this)),e.on(u.MUTED_CHANGED,this._onMutedChanged.bind(this)),e.on(u.SEEK_COMPLETED,this._onSeekCompleted.bind(this)),e.on(u.TWITCH_INFO,this._onTwitchInfo.bind(this)),e.on(a.STATS,function(e){y(this._stats,e)}.bind(this)),e.on(a.STATE_CHANGED,this._onStateChanged.bind(this)),e.on(a.SAVE_ITEM,this._saveItem.bind(this)),e.on(a.CONFIGURE,t.configure.bind(t)),e.on(a.ENQUEUE,t.enqueue.bind(t)),e.on(a.SET_TIMESTAMP_OFFSET,t.setTimestampOffset.bind(t)),e.on(a.PLAY,this._startPlayback.bind(this)),e.on(a.PAUSE,t.pause.bind(t)),e.on(a.REMOVE,t.remove.bind(t)),e.on(a.RESET,t.reset.bind(t)),e.on(a.SEEK_TO,t.seekTo.bind(t)),e.on(a.SET_PLAYBACK_RATE,t.setPlaybackRate.bind(t)),e.on(a.ADD_CUE,this._addCue.bind(this)),e.on(d.ID3,this._onID3.bind(this))},p.prototype._onVolumeChanged=function(){h&&document.hidden&&0===this.getVolume()&&this._postMessage(s.PAUSE)},p.prototype._onMutedChanged=function(){h&&document.hidden&&this.isMuted()&&this._postMessage(s.PAUSE)},p.prototype._onSeekCompleted=function(){this._seekTime=null,this.getPlayerState()===c.PLAYING&&this._emitter.emit(c.PLAYING)},p.prototype._onError=function(){this._isPaused=!0},p.prototype._onStateChanged=function(e){switch(e.playerState){case c.READY:var t=this._filterQualities(e.qualities);e.qualities=t.supported,this._postMessage(s.REMOVE_QUALITIES,t.unsupported),this._isLoaded=!0,this._isPaused||this._attemptPlay();break;case c.ENDED:this._isPaused=!0}y(this._state,e),e.playerState!==c.PLAYING&&this._emitter.emit(e.playerState)},p.prototype._filterQualities=function(e){var t=[],i=[];return e.forEach(function(e){this._isQualitySupported(e)?t.push(e):i.push(e)},this),{supported:t,unsupported:i}},p.prototype._saveItem=function(e){try{localStorage.setItem("cvp."+e.key,e.value)}catch(e){}},p.prototype._startPlayback=function(){this._mediaSink.play().then(function(){this._emitter.emit(c.PLAYING)}.bind(this)).catch(l)},p.prototype._addCue=function(e){this._mediaSink.addCue(e,function(){this._postMessage(s.SINK_CUE,e)}.bind(this))},p.prototype._onID3=function(e){e.forEach(function(e){if("TXXX"===e.id&&"segmentmetadata"===e.desc&&e.info.length){var t=function(e){try{return JSON.parse(e)}catch(t){return console.error("Failed JSON parse:",e),{}}}(e.info[0]);if(t.hasOwnProperty("stream_offset")){var i=Number(t.stream_offset);isNaN(i)||(this._state.startOffset=i-this.getPosition())}}}.bind(this))},p.prototype._onVisibilityChange=function(){this._isPaused||document.hidden||this._attemptPlay(),h&&!this._isPaused&&document.hidden&&(this.isMuted()||0===this.getVolume())&&this._postMessage(s.PAUSE)},p.prototype._onSinkTimeUpdate=function(){this._postMessage(s.SINK_UPDATE,{currentTime:this._mediaSink.currentTime(),decodedFrames:this._mediaSink.decodedFrames(),droppedFrames:this._mediaSink.droppedFrames()}),this._emitter.emit(u.TIME_UPDATE)},p.prototype._onSinkBufferUpdate=function(){this._emitter.emit(u.BUFFER_UPDATE)},p.prototype._onSinkIdle=function(){this._postMessage(s.SINK_IDLE)},p.prototype._onSinkStop=function(){document.hidden?this._emitter.emit(s.PAUSE):this.isMuted()?(this.pause(),this._emitter.emit(u.PLAYBACK_BLOCKED)):(this.setMuted(!0),this._startPlayback(),this._emitter.emit(u.AUDIO_BLOCKED))},p.prototype._onSinkError=function(e){this._postMessage(s.SINK_ERROR,e)},p.prototype._onTwitchInfo=function(e){y(this._state,e)},p.prototype._onWorkerMessage=function(e){var t=e.data;t.id===this._id&&this._emitter.emit(t.type,t.arg)};var _,f=(_=0,function(){return _++});function m(){return"undefined"!=typeof MediaSource}function y(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function E(e){return""===e.codecs||MediaSource.isTypeSupported('video/mp4;codecs="'+e.codecs+'"')}p.isVP9Supported=function(){return m()&&MediaSource.isTypeSupported('video/mp4;codecs="vp09.00.10.08"')}}]);